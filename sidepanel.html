<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sidecar - Nostr Feed</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <svg width="824" height="226" viewBox="0 0 824 226" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M200.381 0C200.381 55.1291 155.609 99.8203 100.381 99.8203C45.1539 99.8203 0.381226 55.1281 0.381226 0H200.381Z" fill="white"/>
                        <path d="M200.381 0H100.929V99.807C155.904 99.5108 200.381 54.9449 200.381 0Z" fill="#D0D1D3"/>
                        <path d="M194.685 33.2253H6.07739C19.1073 70.0701 53.1779 96.9858 93.8872 99.5944V213.036H62.2426C58.6556 213.036 55.7495 215.937 55.7495 219.518C55.7495 223.098 58.6556 225.999 62.2426 225.999H138.52C142.107 225.999 145.013 223.098 145.013 219.518C145.013 215.937 142.107 213.036 138.52 213.036H106.876V99.5944C147.584 96.9858 181.655 70.0701 194.685 33.2253Z" fill="#FFA01B"/>
                        <path d="M194.685 33.2253H100.927V226H138.519C142.106 226 145.012 223.099 145.012 219.519C145.012 215.938 142.106 213.037 138.519 213.037H106.874V99.5944C147.584 96.9858 181.655 70.0701 194.685 33.2253Z" fill="#EA772F"/>
                        <path d="M811.269 182.788C813.862 182.788 817.175 181.635 821.208 179.331C822.649 179.331 823.369 179.907 823.369 181.059C823.369 181.924 822.937 182.644 822.072 183.22C821.496 183.796 818.904 184.804 814.294 186.245C809.685 187.685 805.94 188.405 803.059 188.405C793.552 188.405 788.799 185.381 788.799 179.331C788.799 177.026 789.375 174.577 790.528 171.985C791.968 169.392 792.688 167.663 792.688 166.799C792.688 165.935 792.4 165.503 791.824 165.503C786.062 167.519 777.708 172.561 766.761 180.627L736.08 219.086C733.775 221.967 731.615 223.407 729.598 223.407C727.294 223.407 726.141 222.687 726.141 221.247C726.141 219.806 727.15 217.502 729.166 214.333L756.39 180.195C758.406 177.602 762.151 172.705 767.625 165.503C773.099 158.301 776.268 153.98 777.132 152.539C778.284 151.099 780.301 150.379 783.181 150.379C786.35 150.379 787.935 150.955 787.935 152.107C787.935 153.259 787.647 154.124 787.071 154.7L781.021 163.342C780.157 164.495 779.148 165.647 777.996 166.799C780.589 166.223 790.96 161.038 809.109 151.243C809.685 150.955 810.693 150.811 812.134 150.811C813.574 150.811 814.294 151.243 814.294 152.107C814.294 152.683 814.006 153.403 813.43 154.268C813.142 154.844 811.702 156.716 809.109 159.885C803.923 166.223 801.331 170.976 801.331 174.145C801.331 179.907 804.644 182.788 811.269 182.788Z" fill="#BDA1FF"/>
                        <path d="M656.691 216.061C667.926 216.061 680.458 210.3 694.286 198.776C708.114 186.965 716.18 176.882 718.485 168.528C718.485 165.071 716.324 162.19 712.003 159.885C707.682 157.293 702.784 155.996 697.311 155.996C684.059 155.996 671.815 161.758 660.58 173.281C649.633 184.516 644.16 194.455 644.16 203.098C644.16 211.74 648.337 216.061 656.691 216.061ZM701.2 149.082C711.283 149.082 719.637 152.683 726.263 159.885C726.551 159.885 728.856 157.725 733.177 153.403C735.193 150.235 737.498 148.65 740.091 148.65C742.684 148.65 743.98 149.946 743.98 152.539L742.251 156.428C741.387 157.869 735.626 164.927 724.966 177.602C714.596 190.278 708.546 197.768 706.817 200.073C705.377 202.377 704.657 205.834 704.657 210.444C704.657 213.613 706.673 215.197 710.706 215.197C719.061 215.197 730.872 208.283 746.14 194.455C747.005 193.303 747.869 192.727 748.733 192.727C749.886 192.727 750.462 193.447 750.462 194.887C750.462 198.344 744.556 203.818 732.745 211.308C721.221 218.798 710.85 222.543 701.632 222.543C695.294 222.543 692.125 219.23 692.125 212.604C692.125 210.3 691.693 209.147 690.829 209.147C690.253 209.147 689.821 209.291 689.532 209.579C675.128 219.086 661.445 223.839 648.481 223.839C635.805 223.839 629.467 218.078 629.467 206.555C629.467 194.455 636.669 181.924 651.074 168.96C665.478 155.708 682.186 149.082 701.2 149.082Z" fill="#BDA1FF"/>
                        <path d="M566.074 226C544.756 226 534.097 219.086 534.097 205.258C534.097 192.871 541.587 180.195 556.567 167.231C571.547 153.98 587.104 147.354 603.236 147.354C619.657 147.354 627.867 152.683 627.867 163.342C627.867 169.968 624.554 175.874 617.928 181.059C611.303 186.245 605.253 188.837 599.779 188.837C594.594 188.837 590.705 187.829 588.112 185.813C585.807 183.508 584.655 181.491 584.655 179.763C584.655 177.746 585.663 175.586 587.68 173.281C589.985 170.688 591.857 169.248 593.297 168.96C595.89 168.96 597.187 170.112 597.187 172.417C597.187 172.993 596.898 173.713 596.322 174.577C595.746 175.154 595.458 177.026 595.458 180.195C595.458 182.5 597.043 183.652 600.211 183.652C603.668 183.652 607.125 182.068 610.582 178.899C614.327 175.442 616.2 171.409 616.2 166.799C616.2 157.004 610.726 152.107 599.779 152.107C588.832 152.107 577.453 158.013 565.642 169.824C553.83 181.347 547.925 192.294 547.925 202.665C547.925 214.189 556.135 219.95 572.556 219.95C595.89 219.95 615.768 211.452 632.188 194.455C633.053 193.303 633.917 192.727 634.781 192.727C635.934 192.727 636.51 193.591 636.51 195.319C636.51 196.76 634.205 199.785 629.596 204.394C624.986 209.003 616.92 213.757 605.397 218.654C593.874 223.551 580.766 226 566.074 226Z" fill="#BDA1FF"/>
                        <path d="M467.756 198.776V201.801C500.021 189.414 516.153 177.026 516.153 164.639C516.153 158.301 512.12 155.132 504.054 155.132C496.276 155.132 488.21 160.029 479.855 169.824C471.789 179.619 467.756 189.27 467.756 198.776ZM526.957 161.182C526.957 178.467 507.655 193.447 469.052 206.122C471.357 212.748 477.695 216.061 488.065 216.061C505.638 216.061 522.347 208.859 538.192 194.455C539.056 193.303 539.92 192.727 540.784 192.727C541.937 192.727 542.513 193.735 542.513 195.751C542.513 197.48 539.92 200.505 534.735 204.826C529.549 209.147 522.203 213.324 512.696 217.358C503.19 221.391 493.827 223.407 484.609 223.407C465.019 223.407 455.224 216.205 455.224 201.801C455.224 189.99 461.13 178.034 472.941 165.935C485.041 153.836 498.004 147.786 511.832 147.786C521.915 147.786 526.957 152.251 526.957 161.182Z" fill="#BDA1FF"/>
                        <path d="M424.905 52.7189C424.905 65.6826 428.794 78.2142 436.572 90.3136C444.35 102.413 454.721 110.911 467.685 115.809C476.615 89.8815 481.081 67.6992 481.081 49.262C481.081 21.8942 472.294 8.21032 454.721 8.21032C447.231 8.21032 441.037 11.5233 436.14 18.1491C428.65 28.232 424.905 39.7553 424.905 52.7189ZM414.966 146.922C420.151 146.922 424.761 147.93 428.794 149.946C433.115 151.963 436.14 154.124 437.868 156.428L440.029 159.453C440.029 162.91 438.589 164.639 435.708 164.639C433.979 164.639 432.683 163.486 431.819 161.182C425.769 156.284 418.855 153.836 411.077 153.836C397.537 153.836 385.726 159.309 375.643 170.256C365.56 181.203 360.519 191.718 360.519 201.801C360.519 211.884 365.416 216.925 375.211 216.925C392.496 216.925 409.06 207.851 424.905 189.702C441.037 171.553 454.289 149.226 464.66 122.723C451.12 118.69 439.597 110.623 430.09 98.5239C420.584 86.4245 415.83 73.7489 415.83 60.4971C415.83 47.2454 419.575 33.8496 427.065 20.3097C434.844 6.76991 445.215 0 458.178 0C467.685 0 475.607 4.75334 481.945 14.26C488.571 23.7667 491.884 36.7304 491.884 53.1511C491.884 69.5717 486.986 91.3219 477.192 118.402C479.496 118.978 482.953 119.266 487.563 119.266C506.864 119.266 524.005 111.344 538.985 95.4991C542.73 91.754 545.179 89.8815 546.331 89.8815C547.772 89.8815 548.492 90.8897 548.492 92.9063C548.492 94.6348 547.339 96.6514 545.035 98.956C528.038 116.529 506.864 125.315 481.513 125.315C478.344 125.315 476.039 125.171 474.599 124.883C463.076 153.115 447.951 176.882 429.226 196.184C410.789 215.197 390.623 224.704 368.729 224.704C356.053 224.704 349.715 218.078 349.715 204.826C349.715 191.574 355.765 178.611 367.865 165.935C380.252 153.259 395.953 146.922 414.966 146.922Z" fill="#BDA1FF"/>
                        <path d="M375.39 109.759C372.797 112.64 371.501 115.377 371.501 117.969C371.501 121.714 373.517 123.587 377.55 123.587C379.567 123.587 382.015 122.435 384.896 120.13C388.065 117.825 389.65 115.377 389.65 112.784C389.65 110.191 388.929 108.319 387.489 107.166C386.337 105.726 384.608 105.006 382.304 105.006C380.287 105.006 377.982 106.59 375.39 109.759ZM310.571 210.444C310.571 213.613 312.588 215.197 316.621 215.197C324.975 215.197 336.787 208.283 352.055 194.455C352.919 193.303 353.783 192.727 354.648 192.727C355.8 192.727 356.376 193.447 356.376 194.887C356.376 198.344 350.471 203.818 338.659 211.308C327.136 218.798 316.765 222.543 307.546 222.543C301.209 222.543 298.04 219.23 298.04 212.604C298.04 208.859 299.912 204.394 303.657 199.208C305.098 197.48 306.97 195.319 309.275 192.727C311.58 189.846 313.596 187.253 315.325 184.948C317.341 182.644 321.23 178.178 326.992 171.553C332.754 164.639 337.219 159.165 340.388 155.132C343.845 151.099 346.149 148.65 347.302 147.786C348.454 146.634 349.75 146.057 351.191 146.057C352.919 146.057 354.216 146.489 355.08 147.354C356.232 148.218 356.808 149.226 356.808 150.379C356.808 151.531 355.944 152.971 354.216 154.7L321.806 191.43C314.316 199.496 310.571 205.834 310.571 210.444Z" fill="#BDA1FF"/>
                        <path d="M200.691 204.394C200.691 195.751 204.148 188.693 211.062 183.22C217.976 177.746 225.466 175.01 233.532 175.01C241.886 175.01 246.063 178.611 246.063 185.813C246.063 188.982 244.911 192.15 242.606 195.319C240.59 198.488 238.285 200.073 235.693 200.073C233.388 200.073 232.236 199.208 232.236 197.48C232.236 195.463 233.1 193.591 234.828 191.862C236.845 190.134 237.853 188.405 237.853 186.677C237.853 181.779 235.548 179.331 230.939 179.331C226.33 179.331 221.865 181.491 217.543 185.813C213.51 189.846 211.494 194.743 211.494 200.505C211.494 205.978 212.934 210.588 215.815 214.333C218.696 218.078 223.161 219.95 229.211 219.95C235.548 219.95 240.878 217.358 245.199 212.172C249.809 206.699 253.266 200.217 255.57 192.727C257.875 184.948 260.324 177.17 262.916 169.392C265.797 161.614 269.974 155.132 275.448 149.946C281.209 144.473 287.403 141.736 294.029 141.736C300.655 141.736 305.84 142.888 309.585 145.193C313.331 147.21 315.203 149.946 315.203 153.403C315.203 156.86 313.763 160.173 310.882 163.342C308.289 166.511 305.408 168.096 302.239 168.096C299.07 168.096 297.342 167.375 297.054 165.935C297.054 163.63 298.638 161.614 301.807 159.885C303.536 159.309 304.4 157.293 304.4 153.836C304.4 149.226 301.231 146.922 294.893 146.922C288.556 146.922 283.226 151.099 278.905 159.453C274.584 167.519 271.271 176.45 268.966 186.245C266.949 195.751 262.34 204.682 255.138 213.036C247.936 221.103 238.285 225.136 226.186 225.136C218.696 225.136 212.79 223.407 208.469 219.95C204.148 216.493 201.843 213.036 201.555 209.579L200.691 204.394Z" fill="#BDA1FF"/>
                    </svg>
                </div>
                <div class="auth-section">
                    <div id="signed-out" class="auth-state">
                        <button id="sign-in-btn" class="btn btn-primary">Sign In</button>
                        <button id="generate-keys-btn" class="btn btn-secondary">New Keys</button>
                    </div>
                    <div id="signed-in" class="auth-state hidden">
                        <div class="logged-in-user" id="user-profile-btn">
                            <div class="user-avatar" id="user-avatar">
                                <div class="avatar-placeholder" id="user-avatar-placeholder"></div>
                            </div>
                            <div class="profile-menu-arrow">‚åÑ</div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Note Posted Notification -->
        <div id="note-posted-notification" class="note-posted-notification hidden">
            ‚úì Note posted
        </div>

        <!-- Feed Toggle -->
        <div class="feed-toggle">
            <button id="following-feed-btn" class="toggle-btn hidden" disabled>Following</button>
            <button id="trending-feed-btn" class="toggle-btn active">Trending</button>
            <button id="me-feed-btn" class="toggle-btn hidden" disabled>Me</button>
        </div>

        <!-- Feed -->
        <div class="feed-container">
            <div id="loading" class="loading">
                <div class="spinner"></div>
                <span>Loading feed...</span>
            </div>
            <div id="feed" class="feed"></div>
            <div id="auto-loader" class="auto-loader">
                <div id="auto-loading" class="auto-loading hidden">
                    <div class="spinner small"></div>
                    <span>Loading feed...</span>
                </div>
                <div id="end-of-feed" class="end-of-feed hidden">
                    <span>End of feed.</span>
                    <button id="reload-feed-btn" class="btn btn-secondary">Click to reload</button>
                </div>
            </div>
            <div id="error" class="error hidden">
                <p>Failed to load feed. Please try again.</p>
                <button id="retry-btn" class="btn btn-secondary">Retry</button>
            </div>
        </div>

        <!-- Floating Compose Button -->
        <button id="floating-compose-btn" class="floating-btn hidden" title="Create Post">+</button>

        <!-- Compose Section (only when signed in) -->
        <div id="compose-section" class="compose-section hidden">
            <textarea id="compose-text" placeholder="What's happening?" maxlength="2100"></textarea>
            <div class="compose-actions">
                <span id="char-count" class="char-count" style="display: none;">2100</span>
                <button id="cancel-compose-btn" class="btn btn-secondary">Cancel</button>
                <button id="post-btn" class="btn btn-primary" disabled>Post</button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <div id="auth-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Sign In</h2>
                <button id="close-modal" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="sign-in-form" class="auth-form">
                    <div class="nip07-section">
                        <button id="nip07-btn" class="btn btn-primary btn-full">
                            üîë Use Browser Extension (Alby/Nos2x)
                        </button>
                        <div class="divider">or</div>
                    </div>
                    <div class="manual-key-section">
                        <label for="private-key-input">Private Key (nsec or hex):</label>
                        <input type="password" id="private-key-input" placeholder="nsec1... or hex key">
                        <button id="import-key-btn" class="btn btn-secondary btn-full">Import Key</button>
                    </div>
                </div>
                <div id="generate-keys-form" class="auth-form hidden">
                    <div class="key-generation">
                        <p>Generate a new Nostr identity:</p>
                        <div class="generated-keys">
                            <div class="key-pair">
                                <label>Public Key (npub):</label>
                                <div class="key-display">
                                    <input type="text" id="generated-npub" readonly>
                                    <button class="copy-btn" data-copy="npub">üìã</button>
                                </div>
                            </div>
                            <div class="key-pair">
                                <label>Private Key (nsec):</label>
                                <div class="key-display">
                                    <input type="password" id="generated-nsec" readonly>
                                    <button class="copy-btn" data-copy="nsec">üìã</button>
                                    <button class="toggle-visibility" data-target="generated-nsec">üëÅÔ∏è</button>
                                </div>
                            </div>
                        </div>
                        <div class="warning">
                            ‚ö†Ô∏è Save your private key securely. You cannot recover it if lost!
                        </div>
                        <button id="save-generated-keys-btn" class="btn btn-primary btn-full">Save & Use Keys</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Reply Modal -->
    <div id="reply-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Reply to Note</h2>
                <button id="close-reply-modal" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="reply-to-note" class="reply-context"></div>
                <textarea id="reply-text" placeholder="Write your reply..." maxlength="2100"></textarea>
                <div class="reply-actions">
                    <span id="reply-char-count" class="char-count" style="display: none;">2100</span>
                    <button id="cancel-reply-btn" class="btn btn-secondary">Cancel</button>
                    <button id="send-reply-btn" class="btn btn-primary" disabled>Reply</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Repost Modal -->
    <div id="repost-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Repost Note</h2>
                <button id="close-repost-modal" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div id="repost-note" class="repost-context"></div>
                <div class="repost-options">
                    <button id="simple-repost-btn" class="btn btn-primary">
                        <svg width="16" height="18" viewBox="0 0 18 20" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 8px;">
                            <path d="M16.0352 8.11791C16.8237 8.11808 17.4883 8.70721 17.582 9.48998V11.4831C17.582 14.8189 14.8533 17.5476 11.5176 17.5476H5.99316V19.5603C5.99316 19.7272 5.9061 19.8709 5.75879 19.948C5.6104 20.0251 5.44428 20.0153 5.30664 19.9206L0.189453 16.3884C0.0676321 16.3046 0.000140374 16.1772 0 16.029C0 15.8807 0.0674907 15.7526 0.189453 15.6687L5.30664 12.1365C5.44428 12.0418 5.61139 12.032 5.75879 12.1091C5.90611 12.1872 5.99316 12.3299 5.99316 12.4968V14.4519H11.5176C13.1449 14.4519 14.4873 13.1095 14.4873 11.4822V9.48998C14.581 8.70709 15.2464 8.11791 16.0352 8.11791ZM11.8242 0.0515075C11.9726 -0.02561 12.1387 -0.0158394 12.2764 0.0788513L17.3936 3.6101C17.5156 3.69403 17.583 3.82211 17.583 3.97045C17.583 4.11883 17.5156 4.24685 17.3936 4.3308L12.2764 7.86303C12.1388 7.95759 11.9715 7.96744 11.8242 7.89037C11.6769 7.81232 11.5899 7.66949 11.5898 7.50268V5.5476H6.06543C4.43821 5.5476 3.0959 6.88922 3.0957 8.51635V10.5095C3.00183 11.2922 2.33647 11.8816 1.54785 11.8816C0.759382 11.8814 0.094857 11.2921 0.000976562 10.5095V8.51635C0.00115355 5.1808 2.72984 2.45287 6.06543 2.45287L11.5898 2.4519V0.438226C11.59 0.271594 11.6771 0.128595 11.8242 0.0515075Z" fill="currentColor"/>
                        </svg>
                        Repost
                    </button>
                    <button id="quote-repost-btn" class="btn btn-primary">
                        <svg width="16" height="16" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg" style="margin-right: 8px;">
                            <path d="M16.4657 7.87988C16.5129 7.78563 16.937 6.46617 18.6805 4.95822C19.5759 4.20424 18.9162 2.79054 17.7852 3.02616C14.2981 3.78013 10.2454 6.04206 10.481 12.5451C10.481 15.1369 12.6959 17.1161 15.2877 17.1161C17.8794 17.1161 20 14.9955 20 12.4037C19.9529 10.2361 18.4921 8.39824 16.4657 7.87988Z" fill="currentColor"/>
                            <path d="M5.9945 7.87988C6.04163 7.78563 6.46574 6.46617 8.20931 4.95822C9.10465 4.20424 8.44493 2.79054 7.31396 3.02616C3.82682 3.78013 -0.225805 6.04206 0.00981258 12.5451C0.00981258 15.1369 2.22462 17.1161 4.81641 17.1161C7.40821 17.1161 9.52877 14.9955 9.52877 12.4037C9.52877 10.2361 8.02081 8.39824 5.9945 7.87988Z" fill="currentColor"/>
                        </svg>
                        Quote
                    </button>
                </div>
                <div id="quote-compose" class="quote-compose-section hidden">
                    <textarea id="quote-text" placeholder="Add your thoughts..." maxlength="2100"></textarea>
                    <div class="quote-actions">
                        <span id="quote-char-count" class="char-count">2100</span>
                        <button id="cancel-quote-btn" class="btn btn-secondary">Cancel</button>
                        <button id="send-quote-btn" class="btn btn-primary" disabled>Post Quote</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="emoji-picker-modal" class="modal hidden">
        <div class="modal-content small">
            <div class="modal-header">
                <h2>Choose Reaction</h2>
                <button class="close-btn" data-modal="emoji-picker-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="emoji-grid">
                    <button class="emoji-btn" data-emoji="ü§ô">ü§ô</button>
                    <button class="emoji-btn" data-emoji="‚ù§Ô∏è">‚ù§Ô∏è</button>
                    <button class="emoji-btn" data-emoji="üòÇ">üòÇ</button>
                    <button class="emoji-btn" data-emoji="üòç">üòç</button>
                    <button class="emoji-btn" data-emoji="üî•">üî•</button>
                    <button class="emoji-btn" data-emoji="üëè">üëè</button>
                    <button class="emoji-btn" data-emoji="üöÄ">üöÄ</button>
                    <button class="emoji-btn" data-emoji="‚≠ê">‚≠ê</button>
                    <button class="emoji-btn" data-emoji="üíØ">üíØ</button>
                    <button class="emoji-btn" data-emoji="üôå">üôå</button>
                    <button class="emoji-btn" data-emoji="üëç">üëç</button>
                    <button class="emoji-btn" data-emoji="üëé">üëé</button>
                    <button class="emoji-btn" data-emoji="üò¢">üò¢</button>
                    <button class="emoji-btn" data-emoji="üò°">üò°</button>
                    <button class="emoji-btn" data-emoji="ü§î">ü§î</button>
                    <button class="emoji-btn" data-emoji="üéâ">üéâ</button>
                </div>
                <div class="custom-emoji-section">
                    <input type="text" id="custom-emoji-input" placeholder="Type any emoji..." maxlength="4">
                    <button id="custom-emoji-btn" class="btn btn-primary">Use Custom</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Version Modal -->
    <div id="version-modal" class="modal hidden">
        <div class="modal-content small">
            <div class="modal-header">
                <h2>about sidecar</h2>
                <button class="close-btn" data-modal="version-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="version-info">
                    <div class="app-logo">
                        <svg width="824" height="226" viewBox="0 0 824 226" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M200.381 0C200.381 55.1291 155.609 99.8203 100.381 99.8203C45.1539 99.8203 0.381226 55.1281 0.381226 0H200.381Z" fill="white"/>
                            <path d="M200.381 0H100.929V99.807C155.904 99.5108 200.381 54.9449 200.381 0Z" fill="#D0D1D3"/>
                            <path d="M194.685 33.2253H6.07739C19.1073 70.0701 53.1779 96.9858 93.8872 99.5944V213.036H62.2426C58.6556 213.036 55.7495 215.937 55.7495 219.518C55.7495 223.098 58.6556 225.999 62.2426 225.999H138.52C142.107 225.999 145.013 223.098 145.013 219.518C145.013 215.937 142.107 213.036 138.52 213.036H106.876V99.5944C147.584 96.9858 181.655 70.0701 194.685 33.2253Z" fill="#FFA01B"/>
                            <path d="M194.685 33.2253H100.927V226H138.519C142.106 226 145.012 223.099 145.012 219.519C145.012 215.938 142.106 213.037 138.519 213.037H106.874V99.5944C147.584 96.9858 181.655 70.0701 194.685 33.2253Z" fill="#EA772F"/>
                            <path d="M811.269 182.788C813.862 182.788 817.175 181.635 821.208 179.331C822.649 179.331 823.369 179.907 823.369 181.059C823.369 181.924 822.937 182.644 822.072 183.22C821.496 183.796 818.904 184.804 814.294 186.245C809.685 187.685 805.94 188.405 803.059 188.405C793.552 188.405 788.799 185.381 788.799 179.331C788.799 177.026 789.375 174.577 790.528 171.985C791.968 169.392 792.688 167.663 792.688 166.799C792.688 165.935 792.4 165.503 791.824 165.503C786.062 167.519 777.708 172.561 766.761 180.627L736.08 219.086C733.775 221.967 731.615 223.407 729.598 223.407C727.294 223.407 726.141 222.687 726.141 221.247C726.141 219.806 727.15 217.502 729.166 214.333L756.39 180.195C758.406 177.602 762.151 172.705 767.625 165.503C773.099 158.301 776.268 153.98 777.132 152.539C778.284 151.099 780.301 150.379 783.181 150.379C786.35 150.379 787.935 150.955 787.935 152.107C787.935 153.259 787.647 154.124 787.071 154.7L781.021 163.342C780.157 164.495 779.148 165.647 777.996 166.799C780.589 166.223 790.96 161.038 809.109 151.243C809.685 150.955 810.693 150.811 812.134 150.811C813.574 150.811 814.294 151.243 814.294 152.107C814.294 152.683 814.006 153.403 813.43 154.268C813.142 154.844 811.702 156.716 809.109 159.885C803.923 166.223 801.331 170.976 801.331 174.145C801.331 179.907 804.644 182.788 811.269 182.788Z" fill="#BDA1FF"/>
                            <path d="M656.691 216.061C667.926 216.061 680.458 210.3 694.286 198.776C708.114 186.965 716.18 176.882 718.485 168.528C718.485 165.071 716.324 162.19 712.003 159.885C707.682 157.293 702.784 155.996 697.311 155.996C684.059 155.996 671.815 161.758 660.58 173.281C649.633 184.516 644.16 194.455 644.16 203.098C644.16 211.74 648.337 216.061 656.691 216.061ZM701.2 149.082C711.283 149.082 719.637 152.683 726.263 159.885C726.551 159.885 728.856 157.725 733.177 153.403C735.193 150.235 737.498 148.65 740.091 148.65C742.684 148.65 743.98 149.946 743.98 152.539L742.251 156.428C741.387 157.869 735.626 164.927 724.966 177.602C714.596 190.278 708.546 197.768 706.817 200.073C705.377 202.377 704.657 205.834 704.657 210.444C704.657 213.613 706.673 215.197 710.706 215.197C719.061 215.197 730.872 208.283 746.14 194.455C747.005 193.303 747.869 192.727 748.733 192.727C749.886 192.727 750.462 193.447 750.462 194.887C750.462 198.344 744.556 203.818 732.745 211.308C721.221 218.798 710.85 222.543 701.632 222.543C695.294 222.543 692.125 219.23 692.125 212.604C692.125 210.3 691.693 209.147 690.829 209.147C690.253 209.147 689.821 209.291 689.532 209.579C675.128 219.086 661.445 223.839 648.481 223.839C635.805 223.839 629.467 218.078 629.467 206.555C629.467 194.455 636.669 181.924 651.074 168.96C665.478 155.708 682.186 149.082 701.2 149.082Z" fill="#BDA1FF"/>
                            <path d="M566.074 226C544.756 226 534.097 219.086 534.097 205.258C534.097 192.871 541.587 180.195 556.567 167.231C571.547 153.98 587.104 147.354 603.236 147.354C619.657 147.354 627.867 152.683 627.867 163.342C627.867 169.968 624.554 175.874 617.928 181.059C611.303 186.245 605.253 188.837 599.779 188.837C594.594 188.837 590.705 187.829 588.112 185.813C585.807 183.508 584.655 181.491 584.655 179.763C584.655 177.746 585.663 175.586 587.68 173.281C589.985 170.688 591.857 169.248 593.297 168.96C595.89 168.96 597.187 170.112 597.187 172.417C597.187 172.993 596.898 173.713 596.322 174.577C595.746 175.154 595.458 177.026 595.458 180.195C595.458 182.5 597.043 183.652 600.211 183.652C603.668 183.652 607.125 182.068 610.582 178.899C614.327 175.442 616.2 171.409 616.2 166.799C616.2 157.004 610.726 152.107 599.779 152.107C588.832 152.107 577.453 158.013 565.642 169.824C553.83 181.347 547.925 192.294 547.925 202.665C547.925 214.189 556.135 219.95 572.556 219.95C595.89 219.95 615.768 211.452 632.188 194.455C633.053 193.303 633.917 192.727 634.781 192.727C635.934 192.727 636.51 193.591 636.51 195.319C636.51 196.76 634.205 199.785 629.596 204.394C624.986 209.003 616.92 213.757 605.397 218.654C593.874 223.551 580.766 226 566.074 226Z" fill="#BDA1FF"/>
                            <path d="M467.756 198.776V201.801C500.021 189.414 516.153 177.026 516.153 164.639C516.153 158.301 512.12 155.132 504.054 155.132C496.276 155.132 488.21 160.029 479.855 169.824C471.789 179.619 467.756 189.27 467.756 198.776ZM526.957 161.182C526.957 178.467 507.655 193.447 469.052 206.122C471.357 212.748 477.695 216.061 488.065 216.061C505.638 216.061 522.347 208.859 538.192 194.455C539.056 193.303 539.92 192.727 540.784 192.727C541.937 192.727 542.513 193.735 542.513 195.751C542.513 197.48 539.92 200.505 534.735 204.826C529.549 209.147 522.203 213.324 512.696 217.358C503.19 221.391 493.827 223.407 484.609 223.407C465.019 223.407 455.224 216.205 455.224 201.801C455.224 189.99 461.13 178.034 472.941 165.935C485.041 153.836 498.004 147.786 511.832 147.786C521.915 147.786 526.957 152.251 526.957 161.182Z" fill="#BDA1FF"/>
                            <path d="M424.905 52.7189C424.905 65.6826 428.794 78.2142 436.572 90.3136C444.35 102.413 454.721 110.911 467.685 115.809C476.615 89.8815 481.081 67.6992 481.081 49.262C481.081 21.8942 472.294 8.21032 454.721 8.21032C447.231 8.21032 441.037 11.5233 436.14 18.1491C428.65 28.232 424.905 39.7553 424.905 52.7189ZM414.966 146.922C420.151 146.922 424.761 147.93 428.794 149.946C433.115 151.963 436.14 154.124 437.868 156.428L440.029 159.453C440.029 162.91 438.589 164.639 435.708 164.639C433.979 164.639 432.683 163.486 431.819 161.182C425.769 156.284 418.855 153.836 411.077 153.836C397.537 153.836 385.726 159.309 375.643 170.256C365.56 181.203 360.519 191.718 360.519 201.801C360.519 211.884 365.416 216.925 375.211 216.925C392.496 216.925 409.06 207.851 424.905 189.702C441.037 171.553 454.289 149.226 464.66 122.723C451.12 118.69 439.597 110.623 430.09 98.5239C420.584 86.4245 415.83 73.7489 415.83 60.4971C415.83 47.2454 419.575 33.8496 427.065 20.3097C434.844 6.76991 445.215 0 458.178 0C467.685 0 475.607 4.75334 481.945 14.26C488.571 23.7667 491.884 36.7304 491.884 53.1511C491.884 69.5717 486.986 91.3219 477.192 118.402C479.496 118.978 482.953 119.266 487.563 119.266C506.864 119.266 524.005 111.344 538.985 95.4991C542.73 91.754 545.179 89.8815 546.331 89.8815C547.772 89.8815 548.492 90.8897 548.492 92.9063C548.492 94.6348 547.339 96.6514 545.035 98.956C528.038 116.529 506.864 125.315 481.513 125.315C478.344 125.315 476.039 125.171 474.599 124.883C463.076 153.115 447.951 176.882 429.226 196.184C410.789 215.197 390.623 224.704 368.729 224.704C356.053 224.704 349.715 218.078 349.715 204.826C349.715 191.574 355.765 178.611 367.865 165.935C380.252 153.259 395.953 146.922 414.966 146.922Z" fill="#BDA1FF"/>
                            <path d="M375.39 109.759C372.797 112.64 371.501 115.377 371.501 117.969C371.501 121.714 373.517 123.587 377.55 123.587C379.567 123.587 382.015 122.435 384.896 120.13C388.065 117.825 389.65 115.377 389.65 112.784C389.65 110.191 388.929 108.319 387.489 107.166C386.337 105.726 384.608 105.006 382.304 105.006C380.287 105.006 377.982 106.59 375.39 109.759ZM310.571 210.444C310.571 213.613 312.588 215.197 316.621 215.197C324.975 215.197 336.787 208.283 352.055 194.455C352.919 193.303 353.783 192.727 354.648 192.727C355.8 192.727 356.376 193.447 356.376 194.887C356.376 198.344 350.471 203.818 338.659 211.308C327.136 218.798 316.765 222.543 307.546 222.543C301.209 222.543 298.04 219.23 298.04 212.604C298.04 208.859 299.912 204.394 303.657 199.208C305.098 197.48 306.97 195.319 309.275 192.727C311.58 189.846 313.596 187.253 315.325 184.948C317.341 182.644 321.23 178.178 326.992 171.553C332.754 164.639 337.219 159.165 340.388 155.132C343.845 151.099 346.149 148.65 347.302 147.786C348.454 146.634 349.75 146.057 351.191 146.057C352.919 146.057 354.216 146.489 355.08 147.354C356.232 148.218 356.808 149.226 356.808 150.379C356.808 151.531 355.944 152.971 354.216 154.7L321.806 191.43C314.316 199.496 310.571 205.834 310.571 210.444Z" fill="#BDA1FF"/>
                            <path d="M200.691 204.394C200.691 195.751 204.148 188.693 211.062 183.22C217.976 177.746 225.466 175.01 233.532 175.01C241.886 175.01 246.063 178.611 246.063 185.813C246.063 188.982 244.911 192.15 242.606 195.319C240.59 198.488 238.285 200.073 235.693 200.073C233.388 200.073 232.236 199.208 232.236 197.48C232.236 195.463 233.1 193.591 234.828 191.862C236.845 190.134 237.853 188.405 237.853 186.677C237.853 181.779 235.548 179.331 230.939 179.331C226.33 179.331 221.865 181.491 217.543 185.813C213.51 189.846 211.494 194.743 211.494 200.505C211.494 205.978 212.934 210.588 215.815 214.333C218.696 218.078 223.161 219.95 229.211 219.95C235.548 219.95 240.878 217.358 245.199 212.172C249.809 206.699 253.266 200.217 255.57 192.727C257.875 184.948 260.324 177.17 262.916 169.392C265.797 161.614 269.974 155.132 275.448 149.946C281.209 144.473 287.403 141.736 294.029 141.736C300.655 141.736 305.84 142.888 309.585 145.193C313.331 147.21 315.203 149.946 315.203 153.403C315.203 156.86 313.763 160.173 310.882 163.342C308.289 166.511 305.408 168.096 302.239 168.096C299.07 168.096 297.342 167.375 297.054 165.935C297.054 163.63 298.638 161.614 301.807 159.885C303.536 159.309 304.4 157.293 304.4 153.836C304.4 149.226 301.231 146.922 294.893 146.922C288.556 146.922 283.226 151.099 278.905 159.453C274.584 167.519 271.271 176.45 268.966 186.245C266.949 195.751 262.34 204.682 255.138 213.036C247.936 221.103 238.285 225.136 226.186 225.136C218.696 225.136 212.79 223.407 208.469 219.95C204.148 216.493 201.843 213.036 201.555 209.579L200.691 204.394Z" fill="#BDA1FF"/>
                        </svg>
                    </div>
                    <div class="version-number">version <span id="app-version">0.1.0</span></div>
                    <div class="build-number">build <span id="app-build">loading...</span></div>
                    
                    <div class="credits">
                        <div class="credit-item">
                            <span>created by </span>
                            <a href="https://nostree.me/daniel" target="_blank" class="author-link">The Daniel ‚ö°Ô∏è</a>
                        </div>
                        <div class="credit-item">
                            <span>vibed with </span>
                            <a href="https://www.anthropic.com/claude-code" target="_blank" class="claude-credit">Claude</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Zap Modal -->
    <div id="zap-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚ö° Send Zap</h2>
                <button class="close-btn" id="close-zap-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="zap-recipient">
                    <div class="recipient-info">
                        <div id="zap-recipient-name">Loading...</div>
                        <div id="zap-recipient-npub"></div>
                    </div>
                </div>
                
                <div class="zap-amount-section">
                    <label for="zap-amount">Amount (sats)</label>
                    <input type="number" id="zap-amount" value="21" min="1" step="1">
                </div>
                
                <div class="zap-comment-section">
                    <label for="zap-comment">Comment (optional)</label>
                    <input type="text" id="zap-comment" placeholder="Add a comment..." maxlength="250">
                </div>
                
                <div class="wallet-connection-section">
                    <div id="wallet-status" class="wallet-status">
                        <div id="wallet-disconnected" class="wallet-state">
                            <button id="connect-wallet-btn" class="btn btn-secondary">‚ö° Connect Wallet</button>
                            <p class="wallet-help">Connect your Lightning wallet to pay directly without QR codes</p>
                        </div>
                        <div id="wallet-connected" class="wallet-state hidden">
                            <div class="wallet-info">
                                <span class="wallet-icon">‚ö°</span>
                                <span id="wallet-name">Wallet Connected</span>
                                <button id="disconnect-wallet-btn" class="btn-link">Disconnect</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="zap-actions">
                    <button id="send-zap-btn" class="btn btn-primary">Generate Invoice</button>
                    <button id="pay-with-wallet-btn" class="btn btn-primary hidden">Pay with Wallet</button>
                </div>
                
                <div id="zap-invoice-display" class="hidden">
                    <div class="zap-qr-section">
                        <div id="zap-qr-code"></div>
                        <button id="copy-zap-invoice" class="btn btn-secondary">Copy Invoice</button>
                    </div>
                    <div class="zap-invoice-section">
                        <button id="show-invoice-btn" class="btn-link-small">Show invoice details</button>
                        <div id="zap-invoice-text" class="hidden"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Dropdown (positioned absolutely) -->
    <div class="user-dropdown" id="user-dropdown">
        <div class="dropdown-header">
            <div id="dropdown-user-name" class="dropdown-user-name"></div>
            <div id="dropdown-user-npub" class="dropdown-user-npub"></div>
        </div>
        <div class="dropdown-item" id="view-profile-btn">View My Profile</div>
        <div class="dropdown-item" id="copy-key-btn">Copy My Public Key</div>
        <div class="dropdown-item" id="sign-out-btn">Sign Out</div>
    </div>

    <script src="qrious.min.js"></script>
    <script>
        // Debug QRious library loading
        window.addEventListener('load', function() {
            console.log('üîß Checking QRious library after window load...');
            if (typeof QRious !== 'undefined') {
                console.log('‚úÖ QRious library loaded successfully');
                if (QRious.VERSION) {
                    console.log('üì¶ Version:', QRious.VERSION);
                }
            } else {
                console.error('‚ùå QRious library failed to load');
                console.log('Available globals:', Object.keys(window).filter(k => k.includes('QR')));
            }
        });
    </script>
    <script src="nostr-tools.js"></script>
    <script type="module" src="sidepanel.js"></script>
</body>
</html>